<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmbedAI SDK - 基础示例</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .demo-section h3 {
            margin-top: 0;
            color: #495057;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .config-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .config-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        label {
            font-weight: 500;
            color: #495057;
        }
        
        input, select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🤖 EmbedAI SDK 基础示例</h1>
        
        <div class="demo-section">
            <h3>📋 基本配置</h3>
            <div class="config-section">
                <div class="config-group">
                    <label for="serverUrl">服务器地址:</label>
                    <input type="text" id="serverUrl" value="http://localhost:8000" />
                </div>
                <div class="config-group">
                    <label for="knowledgeBaseId">知识库ID:</label>
                    <input type="number" id="knowledgeBaseId" value="1" />
                </div>
                <div class="config-group">
                    <label for="clientId">客户端ID:</label>
                    <input type="text" id="clientId" value="demo-client-123" />
                </div>
                <div class="config-group">
                    <label for="thirdPartyUserId">用户ID:</label>
                    <input type="number" id="thirdPartyUserId" value="1001" />
                </div>
            </div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button onclick="initializeSDK()">初始化 SDK</button>
                <button onclick="destroySDK()">销毁 SDK</button>
            </div>
            
            <div id="initStatus" class="status" style="display: none;"></div>
        </div>
        
        <div class="demo-section">
            <h3>🎮 控制操作</h3>
            <div class="button-group">
                <button onclick="openChat()" id="openBtn" disabled>打开聊天</button>
                <button onclick="closeChat()" id="closeBtn" disabled>关闭聊天</button>
                <button onclick="minimizeChat()" id="minimizeBtn" disabled>最小化</button>
                <button onclick="clearChat()" id="clearBtn" disabled>清空聊天</button>
            </div>
        </div>
        
        <div class="demo-section">
            <h3>🎨 主题配置</h3>
            <div class="config-section">
                <div class="config-group">
                    <label for="primaryColor">主色调:</label>
                    <input type="color" id="primaryColor" value="#007bff" onchange="updateTheme()" />
                </div>
                <div class="config-group">
                    <label for="position">位置:</label>
                    <select id="position" onchange="updatePosition()">
                        <option value="bottom-right">右下角</option>
                        <option value="bottom-left">左下角</option>
                        <option value="top-right">右上角</option>
                        <option value="top-left">左上角</option>
                    </select>
                </div>
                <div class="config-group">
                    <label for="autoOpen">自动打开:</label>
                    <input type="checkbox" id="autoOpen" onchange="updateAutoOpen()" />
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h3>📊 状态信息</h3>
            <div id="statusInfo">
                <p><strong>连接状态:</strong> <span id="connectionStatus">未连接</span></p>
                <p><strong>当前聊天:</strong> <span id="currentChat">无</span></p>
                <p><strong>SDK版本:</strong> <span id="sdkVersion">-</span></p>
            </div>
        </div>
        
        <div class="demo-section">
            <h3>💻 代码示例</h3>
            <div class="code-block" id="codeExample">
// 基础使用示例
const embedai = new EmbedAI({
  serverUrl: 'http://localhost:8000',
  knowledgeBaseId: 1,
  clientId: 'your-client-id',
  thirdPartyUserId: 1001,
  theme: {
    primaryColor: '#007bff'
  },
  position: {
    horizontal: 'right',
    vertical: 'bottom'
  }
});

// 初始化
await embedai.init();

// 事件监听
embedai.on('open', () => console.log('聊天窗口已打开'));
embedai.on('message', (message) => console.log('收到消息:', message));
            </div>
        </div>
    </div>

    <!-- 引入 EmbedAI SDK -->
    <script src="../dist/embedai.min.js"></script>
    
    <script>
        let embedaiInstance = null;
        
        // 更新状态显示
        function updateStatus() {
            const connectionStatus = document.getElementById('connectionStatus');
            const currentChat = document.getElementById('currentChat');
            const sdkVersion = document.getElementById('sdkVersion');
            
            if (embedaiInstance) {
                connectionStatus.textContent = embedaiInstance.getConnectionStatus();
                const chat = embedaiInstance.getCurrentChat();
                currentChat.textContent = chat ? `ID: ${chat.id}` : '无';
                sdkVersion.textContent = EmbedAI.getVersion();
            } else {
                connectionStatus.textContent = '未连接';
                currentChat.textContent = '无';
                sdkVersion.textContent = '-';
            }
        }
        
        // 更新按钮状态
        function updateButtons(enabled) {
            const buttons = ['openBtn', 'closeBtn', 'minimizeBtn', 'clearBtn'];
            buttons.forEach(id => {
                document.getElementById(id).disabled = !enabled;
            });
        }
        
        // 初始化SDK
        async function initializeSDK() {
            try {
                const config = {
                    serverUrl: document.getElementById('serverUrl').value,
                    knowledgeBaseId: parseInt(document.getElementById('knowledgeBaseId').value),
                    clientId: document.getElementById('clientId').value,
                    thirdPartyUserId: parseInt(document.getElementById('thirdPartyUserId').value),
                    autoOpen: document.getElementById('autoOpen').checked,
                    theme: {
                        primaryColor: document.getElementById('primaryColor').value
                    }
                };
                
                // 解析位置配置
                const position = document.getElementById('position').value;
                const [vertical, horizontal] = position.split('-');
                config.position = { horizontal, vertical };
                
                // 销毁现有实例
                if (embedaiInstance) {
                    embedaiInstance.destroy();
                }
                
                // 创建新实例
                embedaiInstance = new EmbedAI(config);
                
                // 添加事件监听
                embedaiInstance.on('open', () => {
                    console.log('聊天窗口已打开');
                    updateStatus();
                });
                
                embedaiInstance.on('close', () => {
                    console.log('聊天窗口已关闭');
                    updateStatus();
                });
                
                embedaiInstance.on('message', (message) => {
                    console.log('收到消息:', message);
                });
                
                // 初始化
                await embedaiInstance.init();
                
                // 更新状态
                updateButtons(true);
                updateStatus();
                
                // 显示成功状态
                const status = document.getElementById('initStatus');
                status.className = 'status connected';
                status.textContent = 'SDK 初始化成功！';
                status.style.display = 'block';
                
            } catch (error) {
                console.error('初始化失败:', error);
                
                // 显示错误状态
                const status = document.getElementById('initStatus');
                status.className = 'status disconnected';
                status.textContent = `初始化失败: ${error.message}`;
                status.style.display = 'block';
            }
        }
        
        // 销毁SDK
        function destroySDK() {
            if (embedaiInstance) {
                embedaiInstance.destroy();
                embedaiInstance = null;
                updateButtons(false);
                updateStatus();
                
                const status = document.getElementById('initStatus');
                status.className = 'status disconnected';
                status.textContent = 'SDK 已销毁';
                status.style.display = 'block';
            }
        }
        
        // 控制函数
        function openChat() {
            if (embedaiInstance) {
                embedaiInstance.open();
            }
        }
        
        function closeChat() {
            if (embedaiInstance) {
                embedaiInstance.close();
            }
        }
        
        function minimizeChat() {
            if (embedaiInstance) {
                embedaiInstance.minimize();
            }
        }
        
        function clearChat() {
            if (embedaiInstance) {
                embedaiInstance.clearChat();
            }
        }
        
        // 更新主题
        function updateTheme() {
            if (embedaiInstance) {
                const primaryColor = document.getElementById('primaryColor').value;
                embedaiInstance.updateConfig({
                    theme: { primaryColor }
                });
            }
        }
        
        // 更新位置
        function updatePosition() {
            if (embedaiInstance) {
                const position = document.getElementById('position').value;
                const [vertical, horizontal] = position.split('-');
                embedaiInstance.updateConfig({
                    position: { horizontal, vertical }
                });
            }
        }
        
        // 更新自动打开
        function updateAutoOpen() {
            if (embedaiInstance) {
                const autoOpen = document.getElementById('autoOpen').checked;
                embedaiInstance.updateConfig({ autoOpen });
            }
        }
        
        // 初始化状态
        updateStatus();
        updateButtons(false);
    </script>
</body>
</html>
