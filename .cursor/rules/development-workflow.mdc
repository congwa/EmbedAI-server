# EmbedAI Server å¼€å‘å·¥ä½œæµç¨‹

## ğŸ¯ å¼€å‘æµç¨‹æ€»è§ˆ

### 1. åŠŸèƒ½å¼€å‘æµç¨‹
```
éœ€æ±‚åˆ†æ â†’ æ¶æ„è®¾è®¡ â†’ æ¨¡å—å¼€å‘ â†’ æµ‹è¯•éªŒè¯ â†’ ä»£ç å®¡æŸ¥ â†’ éƒ¨ç½²ä¸Šçº¿
```

### 2. ä»£ç ä¿®æ”¹æµç¨‹
```
åˆ†æç°æœ‰æ¶æ„ â†’ ç¡®å®šä¿®æ”¹èŒƒå›´ â†’ è®¾è®¡å°è£…æ–¹æ¡ˆ â†’ å®æ–½ä¿®æ”¹ â†’ æµ‹è¯•éªŒè¯ â†’ æ–‡æ¡£æ›´æ–°
```

## ğŸ“‹ å¼€å‘å‰å‡†å¤‡

### 1. æ¶æ„åˆ†æé˜¶æ®µ
- **åˆ†æç°æœ‰æ¨¡å—**: æŸ¥çœ‹ [app/](mdc:app/) ç›®å½•ç»“æ„
- **ç†è§£åˆ†å±‚æ¶æ„**: API â†’ Service â†’ Model
- **è¯†åˆ«ä¾èµ–å…³ç³»**: ç¡®å®šæ¨¡å—é—´çš„ä¾èµ–
- **è¯„ä¼°å½±å“èŒƒå›´**: åˆ†æä¿®æ”¹å¯¹ç°æœ‰åŠŸèƒ½çš„å½±å“

### 2. è®¾è®¡é˜¶æ®µ
- **ç¡®å®šåŠŸèƒ½å½’å±**: 
  - ç®¡ç†ç«¯åŠŸèƒ½ â†’ [app/api/v1/admin/](mdc:app/api/v1/admin/)
  - å®¢æˆ·ç«¯åŠŸèƒ½ â†’ [app/api/v1/client/](mdc:app/api/v1/client/)
  - èŠå¤©åŠŸèƒ½ â†’ [app/api/v1/chat/](mdc:app/api/v1/chat/)
  - WebSocketåŠŸèƒ½ â†’ [app/api/v1/ws/](mdc:app/api/v1/ws/)
- **è®¾è®¡æ•°æ®æ¨¡å‹**: åœ¨ [app/models/](mdc:app/models/) ä¸­å®šä¹‰
- **è®¾è®¡ä¸šåŠ¡é€»è¾‘**: åœ¨ [app/services/](mdc:app/services/) ä¸­å®ç°
- **è®¾è®¡APIæ¥å£**: åœ¨å¯¹åº”çš„APIæ¨¡å—ä¸­å®ç°

## ğŸ”§ å¼€å‘å®æ–½æ­¥éª¤

### 1. é…ç½®ç®¡ç†
```python
# åœ¨ [app/core/config.py](mdc:app/core/config.py) ä¸­æ·»åŠ é…ç½®é¡¹
class Settings(BaseSettings):
    # æ–°åŠŸèƒ½é…ç½®
    NEW_FEATURE_ENABLED: bool = True
    NEW_FEATURE_TIMEOUT: int = 30
```

### 2. æ•°æ®æ¨¡å‹å¼€å‘
```python
# åœ¨ [app/models/](mdc:app/models/) ä¸­åˆ›å»ºæ¨¡å‹
from sqlalchemy import Column, Integer, String, DateTime, ForeignKey
from app.models.database import Base

class NewModel(Base):
    __tablename__ = "new_models"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, nullable=False)
    # å…¶ä»–å­—æ®µ...
```

### 3. Schemaå®šä¹‰
```python
# åœ¨ [app/schemas/](mdc:app/schemas/) ä¸­å®šä¹‰Schema
from pydantic import BaseModel
from typing import Optional

class NewModelCreate(BaseModel):
    name: str
    description: Optional[str] = None

class NewModelResponse(BaseModel):
    id: int
    name: str
    # å…¶ä»–å­—æ®µ...
```

### 4. æœåŠ¡å±‚å¼€å‘
```python
# åœ¨ [app/services/](mdc:app/services/) ä¸­å®ç°ä¸šåŠ¡é€»è¾‘
from app.services.base import BaseService
from app.models.new_model import NewModel

class NewModelService(BaseService):
    def __init__(self):
        super().__init__(NewModel)
    
    async def create_new_model(self, data, user):
        # ä¸šåŠ¡é€»è¾‘å®ç°
        pass
```

### 5. APIå±‚å¼€å‘
```python
# åœ¨å¯¹åº”çš„APIæ¨¡å—ä¸­å®ç°æ¥å£
from fastapi import APIRouter, Depends
from app.services.new_model import NewModelService

router = APIRouter()

@router.post("/new-models/")
async def create_new_model(
    data: NewModelCreate,
    service: NewModelService = Depends()
):
    return await service.create_new_model(data)
```

### 6. è·¯ç”±æ³¨å†Œ
```python
# åœ¨ [app/api/v1/__init__.py](mdc:app/api/v1/__init__.py) ä¸­æ³¨å†Œè·¯ç”±
from .admin import new_model_router

api_router.include_router(
    new_model_router,
    prefix="/new-models",
    tags=["new-models"]
)
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. å•å…ƒæµ‹è¯•
```python
# åœ¨ tests/unit/ ä¸­ç¼–å†™å•å…ƒæµ‹è¯•
import pytest
from app.services.new_model import NewModelService

class TestNewModelService:
    @pytest.mark.asyncio
    async def test_create_new_model(self):
        # æµ‹è¯•å®ç°
        pass
```

### 2. é›†æˆæµ‹è¯•
```python
# åœ¨ tests/integration/ ä¸­ç¼–å†™é›†æˆæµ‹è¯•
def test_new_model_api():
    # APIé›†æˆæµ‹è¯•
    pass
```

### 3. è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/unit/test_new_model.py

# è¿è¡Œå¸¦è¦†ç›–ç‡æµ‹è¯•
pytest --cov=app --cov-report=html
```

## ğŸ“ æ–‡æ¡£æ›´æ–°

### 1. APIæ–‡æ¡£
- æ›´æ–° [docs/api/](mdc:docs/api/) ä¸­çš„APIæ–‡æ¡£
- ç¡®ä¿OpenAPIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆæ­£ç¡®

### 2. ä»£ç æ³¨é‡Š
```python
async def create_new_model(data: NewModelCreate, user: User) -> NewModel:
    """
    åˆ›å»ºæ–°çš„æ¨¡å‹å®ä¾‹
    
    Args:
        data: æ¨¡å‹åˆ›å»ºæ•°æ®
        user: å½“å‰ç”¨æˆ·
        
    Returns:
        NewModel: åˆ›å»ºçš„æ¨¡å‹å®ä¾‹
        
    Raises:
        ValidationError: æ•°æ®éªŒè¯å¤±è´¥
        PermissionError: æƒé™ä¸è¶³
    """
    pass
```

### 3. å˜æ›´æ—¥å¿—
- æ›´æ–° [CHANGELOG.md](mdc:CHANGELOG.md) è®°å½•å˜æ›´
- è®°å½•æ–°åŠŸèƒ½ã€ä¿®å¤å’Œæ”¹è¿›

## ğŸ” ä»£ç å®¡æŸ¥æ¸…å•

### 1. æ¶æ„åˆè§„æ€§
- [ ] éµå¾ªåˆ†å±‚æ¶æ„ (API â†’ Service â†’ Model)
- [ ] ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¨¡å¼
- [ ] é¿å…å¾ªç¯å¯¼å…¥
- [ ] æ¨¡å—èŒè´£æ¸…æ™°

### 2. ä»£ç è´¨é‡
- [ ] ç±»å‹æ³¨è§£å®Œæ•´
- [ ] å¼‚å¸¸å¤„ç†å®Œå–„
- [ ] æ—¥å¿—è®°å½•å……åˆ†
- [ ] ä»£ç æ³¨é‡Šæ¸…æ™°

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### 1. å¾ªç¯å¯¼å…¥é—®é¢˜
```python
# é”™è¯¯ç¤ºä¾‹
from app.services.user import UserService
from app.models.user import User

# æ­£ç¡®ç¤ºä¾‹ - ä½¿ç”¨ä¾èµ–æ³¨å…¥
from fastapi import Depends

def get_user_service():
    return UserService()

@router.get("/")
async def get_users(service = Depends(get_user_service)):
    return await service.get_all()
```

### 2. å¼‚æ­¥æ“ä½œé—®é¢˜
```python
# é”™è¯¯ç¤ºä¾‹
def sync_function():
    result = database.query.all()  # åŒæ­¥æ“ä½œ

# æ­£ç¡®ç¤ºä¾‹
async def async_function():
    result = await database.execute(select(Model))
    return result.scalars().all()
```

### 3. é…ç½®ç®¡ç†é—®é¢˜
```python
# é”™è¯¯ç¤ºä¾‹ - ç¡¬ç¼–ç 
API_KEY = "sk-123456"

# æ­£ç¡®ç¤ºä¾‹ - ä½¿ç”¨é…ç½®
from app.core.config import settings
API_KEY = settings.DEFAULT_API_KEY
```

## ğŸ¯ æœ€ä½³å®è·µæ€»ç»“

1. **å…ˆåˆ†æåå¼€å‘**: å§‹ç»ˆå…ˆç†è§£ç°æœ‰æ¶æ„å†è¿›è¡Œä¿®æ”¹
2. **æ¨¡å—åŒ–è®¾è®¡**: æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹çš„æ¨¡å—
3. **æµ‹è¯•é©±åŠ¨**: å…ˆå†™æµ‹è¯•å†å†™ä»£ç 
4. **æ–‡æ¡£åŒæ­¥**: ä»£ç å’Œæ–‡æ¡£åŒæ­¥æ›´æ–°
5. **æ€§èƒ½ä¼˜å…ˆ**: è€ƒè™‘æ€§èƒ½å½±å“ï¼Œä½¿ç”¨å¼‚æ­¥å’Œç¼“å­˜
6. **å®‰å…¨ç¬¬ä¸€**: å§‹ç»ˆè€ƒè™‘å®‰å…¨æ€§
7. **ä»£ç å¤ç”¨**: é¿å…é‡å¤ä»£ç ï¼Œæå–å…¬å…±ç»„ä»¶
8. **ç‰ˆæœ¬æ§åˆ¶**: åˆç†ä½¿ç”¨Gitåˆ†æ”¯å’Œæäº¤ä¿¡æ¯
description:
globs:
alwaysApply: true
---
