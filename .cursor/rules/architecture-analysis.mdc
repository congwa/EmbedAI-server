# EmbedAI Server æ¶æ„åˆ†æä¸å°è£…è§„åˆ™

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„åŸåˆ™

æ‰€æœ‰åŠŸèƒ½å’Œä¿®æ”¹å¿…é¡»å…ˆåˆ†ææœ¬åœ°æ¶æ„ï¼Œç„¶åæ ¹æ®æ¶æ„è¿›è¡Œå°è£…ä¹‹åå†è¿›è¡Œä¿®æ”¹ã€‚

### 1. åº”ç”¨å…¥å£ä¸é…ç½®
- **ä¸»å…¥å£**: [main.py](mdc:main.py) - FastAPIåº”ç”¨å¯åŠ¨å’Œä¸­é—´ä»¶é…ç½®
- **é…ç½®ç®¡ç†**: [app/core/config.py](mdc:app/core/config.py) - ç»Ÿä¸€é…ç½®ç®¡ç†
- **é¡¹ç›®é…ç½®**: [pyproject.toml](mdc:pyproject.toml) - Poetryä¾èµ–ç®¡ç†

### 2. APIæ¶æ„åˆ†å±‚
```
app/api/v1/
â”œâ”€â”€ admin/     # ç®¡ç†ç«¯API (ç®¡ç†å‘˜åŠŸèƒ½)
â”œâ”€â”€ client/    # å®¢æˆ·ç«¯API (ç¬¬ä¸‰æ–¹ç”¨æˆ·åŠŸèƒ½)  
â”œâ”€â”€ chat/      # èŠå¤©API (èŠå¤©ç›¸å…³åŠŸèƒ½)
â””â”€â”€ ws/        # WebSocket API (å®æ—¶é€šä¿¡)
```

**è·¯ç”±æ³¨å†Œ**: [app/api/v1/__init__.py](mdc:app/api/v1/__init__.py) - ç»Ÿä¸€è·¯ç”±ç®¡ç†

### 3. æ ¸å¿ƒæ¨¡å—æ¶æ„

#### æ•°æ®æ¨¡å‹å±‚ (app/models/)
- **æ•°æ®åº“é…ç½®**: [app/models/database.py](mdc:app/models/database.py)
- **ç”¨æˆ·æ¨¡å‹**: [app/models/user.py](mdc:app/models/user.py)
- **çŸ¥è¯†åº“æ¨¡å‹**: [app/models/knowledge_base.py](mdc:app/models/knowledge_base.py)
- **æ–‡æ¡£æ¨¡å‹**: [app/models/document.py](mdc:app/models/document.py)
- **èŠå¤©æ¨¡å‹**: [app/models/chat.py](mdc:app/models/chat.py)

#### æœåŠ¡å±‚ (app/services/)
- **åŸºç¡€æœåŠ¡**: [app/services/base.py](mdc:app/services/base.py)
- **è®¤è¯æœåŠ¡**: [app/services/auth.py](mdc:app/services/auth.py)
- **çŸ¥è¯†åº“æœåŠ¡**: [app/services/knowledge_base.py](mdc:app/services/knowledge_base.py)
- **æ–‡æ¡£æœåŠ¡**: [app/services/document.py](mdc:app/services/document.py)
- **èŠå¤©æœåŠ¡**: [app/services/chat.py](mdc:app/services/chat.py)
- **æç¤ºè¯æœåŠ¡**: [app/services/prompt.py](mdc:app/services/prompt.py)

#### RAGæ¨¡å— (app/rag/)
- **å‘é‡æ•°æ®åº“**: [app/rag/datasource/](mdc:app/rag/datasource/)
- **åµŒå…¥æ¨¡å‹**: [app/rag/embedding/](mdc:app/rag/embedding/)
- **æ–‡æ¡£å¤„ç†**: [app/rag/extractor/](mdc:app/rag/extractor/)
- **æ–‡æœ¬åˆ†å‰²**: [app/rag/splitter/](mdc:app/rag/splitter/)
- **æ£€ç´¢å¼•æ“**: [app/rag/retrieval/](mdc:app/rag/retrieval/)

#### æ ¸å¿ƒç»„ä»¶ (app/core/)
- **å¼‚å¸¸å¤„ç†**: [app/core/exceptions.py](mdc:app/core/exceptions.py)
- **ä¸­é—´ä»¶**: [app/core/middleware.py](mdc:app/core/middleware.py)
- **æ—¥å¿—ç³»ç»Ÿ**: [app/core/logger.py](mdc:app/core/logger.py)
- **å®‰å…¨ç»„ä»¶**: [app/core/security.py](mdc:app/core/security.py)

## ğŸ“‹ ä¿®æ”¹å‰å¿…é¡»éµå¾ªçš„æ­¥éª¤

### 1. æ¶æ„åˆ†æé˜¶æ®µ
- **ç¡®å®šåŠŸèƒ½å½’å±**: æ˜ç¡®æ–°åŠŸèƒ½å±äºå“ªä¸ªæ¨¡å— (admin/client/chat/ws)
- **è¯†åˆ«ä¾èµ–å…³ç³»**: åˆ†æä¸å…¶ä»–æ¨¡å—çš„ä¾èµ–å…³ç³»
- **è¯„ä¼°å½±å“èŒƒå›´**: ç¡®å®šä¿®æ”¹å¯¹ç°æœ‰åŠŸèƒ½çš„å½±å“

### 2. å°è£…è®¾è®¡é˜¶æ®µ
- **æ¥å£è®¾è®¡**: åœ¨serviceså±‚è®¾è®¡æ¸…æ™°çš„ä¸šåŠ¡æ¥å£
- **æ•°æ®æ¨¡å‹**: åœ¨modelså±‚å®šä¹‰å¿…è¦çš„æ•°æ®ç»“æ„
- **APIè®¾è®¡**: åœ¨apiå±‚è®¾è®¡RESTfulæ¥å£
- **Schemaå®šä¹‰**: åœ¨schemaså±‚å®šä¹‰è¯·æ±‚/å“åº”æ¨¡å‹

### 3. å®ç°é˜¶æ®µ
- **éµå¾ªåˆ†å±‚åŸåˆ™**: ä¸¥æ ¼æŒ‰ç…§APIâ†’Serviceâ†’Modelçš„åˆ†å±‚æ¶æ„
- **å¼‚å¸¸å¤„ç†**: ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- **æ—¥å¿—è®°å½•**: ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿ
- **é…ç½®ç®¡ç†**: é€šè¿‡config.pyç®¡ç†é…ç½®é¡¹

## ğŸ”§ å…·ä½“å®æ–½è§„åˆ™

### APIå¼€å‘è§„åˆ™
1. **è·¯ç”±æ³¨å†Œ**: å¿…é¡»åœ¨ [app/api/v1/__init__.py](mdc:app/api/v1/__init__.py) ä¸­æ³¨å†Œæ–°è·¯ç”±
2. **æƒé™æ§åˆ¶**: ç®¡ç†ç«¯åŠŸèƒ½ä½¿ç”¨adminè·¯ç”±ï¼Œå®¢æˆ·ç«¯åŠŸèƒ½ä½¿ç”¨clientè·¯ç”±
3. **WebSocket**: å®æ—¶åŠŸèƒ½ä½¿ç”¨wsè·¯ç”±
4. **èŠå¤©åŠŸèƒ½**: èŠå¤©ç›¸å…³åŠŸèƒ½ä½¿ç”¨chatè·¯ç”±

### æœåŠ¡å±‚å¼€å‘è§„åˆ™
1. **ç»§æ‰¿åŸºç¡€æœåŠ¡**: æ–°æœåŠ¡å¿…é¡»ç»§æ‰¿ [app/services/base.py](mdc:app/services/base.py)
2. **å¼‚æ­¥å¤„ç†**: æ‰€æœ‰æ•°æ®åº“æ“ä½œå¿…é¡»ä½¿ç”¨å¼‚æ­¥æ–¹å¼
3. **äº‹åŠ¡ç®¡ç†**: å¤æ‚æ“ä½œå¿…é¡»ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡
4. **ç¼“å­˜ç­–ç•¥**: åˆç†ä½¿ç”¨Redisç¼“å­˜æå‡æ€§èƒ½

### æ•°æ®æ¨¡å‹è§„åˆ™
1. **ç»§æ‰¿Base**: æ‰€æœ‰æ¨¡å‹å¿…é¡»ç»§æ‰¿ [app/models/database.py](mdc:app/models/database.py) ä¸­çš„Base
2. **å…³ç³»å®šä¹‰**: æ˜ç¡®å®šä¹‰æ¨¡å‹é—´çš„å…³ç³»
3. **ç´¢å¼•ä¼˜åŒ–**: ä¸ºæŸ¥è¯¢é¢‘ç¹çš„å­—æ®µæ·»åŠ ç´¢å¼•
4. **è¿ç§»ç®¡ç†**: ä½¿ç”¨Alembicç®¡ç†æ•°æ®åº“è¿ç§»

### RAGæ¨¡å—è§„åˆ™
1. **æ¨¡å—åŒ–è®¾è®¡**: æ¯ä¸ªRAGåŠŸèƒ½å¿…é¡»æ˜¯ç‹¬ç«‹çš„æ¨¡å—
2. **å·¥å‚æ¨¡å¼**: ä½¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºä¸åŒçš„å‘é‡æ•°æ®åº“å®ä¾‹
3. **é…ç½®é©±åŠ¨**: é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶RAGè¡Œä¸º
4. **æ€§èƒ½ä¼˜åŒ–**: åˆç†ä½¿ç”¨æ‰¹å¤„ç†å’Œç¼“å­˜

## ğŸš¨ ç¦æ­¢äº‹é¡¹

1. **ç›´æ¥ä¿®æ”¹main.py**: ä¸è¦ç›´æ¥ä¿®æ”¹åº”ç”¨å…¥å£ï¼Œé€šè¿‡æ¨¡å—åŒ–æ–¹å¼æ‰©å±•
2. **è·¨å±‚è°ƒç”¨**: ç¦æ­¢APIå±‚ç›´æ¥è°ƒç”¨Modelå±‚ï¼Œå¿…é¡»é€šè¿‡Serviceå±‚
3. **ç¡¬ç¼–ç é…ç½®**: ç¦æ­¢åœ¨ä»£ç ä¸­ç¡¬ç¼–ç é…ç½®ï¼Œå¿…é¡»ä½¿ç”¨config.py
4. **å¿½ç•¥å¼‚å¸¸**: ç¦æ­¢å¿½ç•¥å¼‚å¸¸ï¼Œå¿…é¡»ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
5. **é‡å¤ä»£ç **: ç¦æ­¢å¤åˆ¶ç²˜è´´ä»£ç ï¼Œå¿…é¡»æå–å…¬å…±ç»„ä»¶

## ğŸ“ ä»£ç å®¡æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œç¡®ä¿ï¼š
- [ ] åŠŸèƒ½å·²æ­£ç¡®åˆ†é…åˆ°å¯¹åº”æ¨¡å—
- [ ] éµå¾ªåˆ†å±‚æ¶æ„åŸåˆ™
- [ ] ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†
- [ ] æ·»åŠ äº†å¿…è¦çš„æ—¥å¿—è®°å½•
- [ ] é…ç½®é¡¹å·²æ·»åŠ åˆ°config.py
- [ ] æ•°æ®åº“è¿ç§»å·²åˆ›å»º
- [ ] å•å…ƒæµ‹è¯•å·²ç¼–å†™
- [ ] APIæ–‡æ¡£å·²æ›´æ–°
description:
globs:
alwaysApply: true
---
